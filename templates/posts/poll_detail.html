{% extends "pages/layouts/_base.html" %}
{% load static %}

{% block title %}{{ poll.title }} - Encuesta{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<div class="container mt-3">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'home' %}">Inicio</a></li>
            <li class="breadcrumb-item"><a href="{% url 'posts:poll_list' %}">Encuestas</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ poll.title }}</li>
        </ol>
    </nav>
</div>

<!-- Contenedor React para poll detail -->
<div id="poll-detail-react"></div>

<!-- Datos para React (ocultos) -->
<script type="application/json" id="poll-detail-data">
{
    "id": {{ poll.id }},
    "title": "{{ poll.title|escapejs }}",
    "description": "{{ poll.description|escapejs }}",
    "created_by": "{{ poll.created_by.username|escapejs }}",
    "star_date": "{{ poll.star_date|date:'c' }}",
    "questions": [
        {% for question in poll.preguntas.all %}
        {
            "id": {{ question.id }},
            "question_text": "{{ question.question_text|escapejs }}",
            "question_type": "{{ question.question_type }}",
            "is_obligatory": {{ question.is_obligatory|yesno:"true,false" }},
            "options": [
                {% for option in question.opciones.all %}
                {
                    "id": {{ option.id }},
                    "options_text": "{{ option.options_text|escapejs }}"
                }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ]
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ]
}
</script>

<script type="text/javascript">
    window.csrfToken = "{{ csrf_token }}";
</script>

<!-- Componente React para Poll Detail -->
<script type="text/babel" src="{% static 'js/react/PollDetailEnhanced.js' %}"></script>
<script type="text/babel">
    // Obtener datos de Django
    const pollDetailData = JSON.parse(document.getElementById('poll-detail-data').textContent);
    
    // Renderizar componente React
    const pollDetailRoot = ReactDOM.createRoot(document.getElementById('poll-detail-react'));
    pollDetailRoot.render(<PollDetailEnhanced pollData={pollDetailData} csrfToken={window.csrfToken} />);
</script>
{% endblock %}