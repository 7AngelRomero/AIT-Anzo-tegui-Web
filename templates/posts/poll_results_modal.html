<h6 class="fw-bold mb-3">{{ poll.title }}</h6>
<p class="text-muted mb-4">{{ total_participations }} participaciones</p>

{% for question in poll.preguntas.all %}
<div class="mb-4">
    <h6 class="fw-bold">{{ forloop.counter }}. {{ question.question_text }}</h6>
    
    {% if question.question_type == 'SELECCION_MULTIPLE' %}
        {% with max_votes=0 max_option=None %}
            {% for option in question.opciones.all %}
                {% with votes=option.respuestas.count %}
                    {% if votes > max_votes %}
                        {% with max_votes=votes max_option=option %}{% endwith %}
                    {% endif %}
                {% endwith %}
            {% endfor %}
            {% if max_option %}
            <div class="alert alert-info">
                <strong>Opci칩n m치s votada:</strong> {{ max_option.options_text }} 
                ({{ max_votes }} votos - {% widthratio max_votes total_participations 100 %}%)
            </div>
            
            <!-- Gr치fico de barras simple -->
            {% for option in question.opciones.all %}
                {% with votes=option.respuestas.count %}
                <div class="mb-2">
                    <div class="d-flex justify-content-between">
                        <span>{{ option.options_text }}</span>
                        <span>{{ votes }} ({% widthratio votes total_participations 100 %}%)</span>
                    </div>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar" style="width: {% widthratio votes total_participations 100 %}%"></div>
                    </div>
                </div>
                {% endwith %}
            {% endfor %}
            {% endif %}
        {% endwith %}
        
    {% elif question.question_type == 'TEXTO_LIBRE' %}
        <div class="border rounded p-3" style="max-height: 200px; overflow-y: auto;">
            {% for response in question.respuestas.all %}
                {% if response.answer_text %}
                <div class="mb-2 p-2 bg-light rounded">
                    <small class="text-muted">{{ response.participation.user.username }}:</small>
                    <div>{{ response.answer_text }}</div>
                </div>
                {% endif %}
            {% empty %}
            <p class="text-muted">No hay respuestas de texto</p>
            {% endfor %}
        </div>
        
    {% elif question.question_type == 'ESCALA_NUMERICA' %}
        {% with total=0 sum=0 %}
            {% for response in question.respuestas.all %}
                {% if response.selected_options %}
                    {% with total=total|add:1 sum=sum|add:response.selected_options.value %}{% endwith %}
                {% endif %}
            {% endfor %}
            {% if total > 0 %}
            <div class="alert alert-success">
                <strong>Promedio:</strong> {% widthratio sum total 1 %}/5 
                ({{ total }} respuestas)
            </div>
            
            <!-- Distribuci칩n de calificaciones -->
            <div class="row">
                {% for i in "12345" %}
                    {% with rating=i|add:0 count=0 %}
                        {% for response in question.respuestas.all %}
                            {% if response.selected_options.value == rating %}
                                {% with count=count|add:1 %}{% endwith %}
                            {% endif %}
                        {% endfor %}
                        <div class="col">
                            <div class="text-center">
                                <div class="fw-bold">{{ rating }}</div>
                                <div class="progress" style="height: 60px; writing-mode: vertical-lr;">
                                    <div class="progress-bar" style="height: {% widthratio count total 100 %}%"></div>
                                </div>
                                <small>{{ count }}</small>
                            </div>
                        </div>
                    {% endwith %}
                {% endfor %}
            </div>
            {% endif %}
        {% endwith %}
    {% endif %}
</div>
{% endfor %}