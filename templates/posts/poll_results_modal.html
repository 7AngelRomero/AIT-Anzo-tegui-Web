<h6 class="fw-bold mb-3">{{ poll.title }}</h6>
<p class="text-muted mb-4">{{ total_participations }} participaciones</p>

{% for question in poll.preguntas.all %}
<div class="mb-4">
    <h6 class="fw-bold">{{ forloop.counter }}. {{ question.question_text }}</h6>
    
    {% if question.question_type == 'SELECCION_MULTIPLE' %}
        <!-- Gráfico de barras simple -->
        {% for option in question.opciones.all %}
            <div class="mb-2">
                {% with votes=0 %}
                    {% for resp in question.respuestas.all %}
                        {% if resp.selected_options.id == option.id %}
                            {% with votes=votes|add:1 %}{% endwith %}
                        {% endif %}
                    {% endfor %}
                    <div class="d-flex justify-content-between">
                        <span>{{ option.options_text }}</span>
                        <span>{{ votes }} ({% if total_participations > 0 %}{% widthratio votes total_participations 100 %}{% else %}0{% endif %}%)</span>
                    </div>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-primary" style="width: {% if total_participations > 0 %}{% widthratio votes total_participations 100 %}{% else %}0{% endif %}%"></div>
                    </div>
                {% endwith %}
            </div>
        {% endfor %}
        
    {% elif question.question_type == 'TEXTO_LIBRE' %}
        <div class="border rounded p-3" style="max-height: 200px; overflow-y: auto;">
            {% for response in question.respuestas.all %}
                {% if response.answer_text %}
                <div class="mb-2 p-2 bg-light rounded">
                    <small class="text-muted">{{ response.participation.user.username }}:</small>
                    <div>{{ response.answer_text }}</div>
                </div>
                {% endif %}
            {% empty %}
            <p class="text-muted">No hay respuestas de texto</p>
            {% endfor %}
        </div>
        
    {% elif question.question_type == 'ESCALA_NUMERICA' %}
        {% with total=0 sum=0 %}
            {% for response in question.respuestas.all %}
                {% if response.selected_options and response.selected_options.value %}
                    {% with total=total|add:1 sum=sum|add:response.selected_options.value %}{% endwith %}
                {% endif %}
            {% endfor %}
            {% if total > 0 %}
            <div class="alert alert-success">
                <strong>Promedio:</strong> {% widthratio sum total 1 %}/5 
                ({{ total }} respuestas)
            </div>
            
            <!-- Distribución de calificaciones -->
            <div class="row">
                {% for i in "12345" %}
                    <div class="col">
                        {% with rating=i count=0 %}
                            {% for response in question.respuestas.all %}
                                {% if response.selected_options and response.selected_options.value|stringformat:"s" == rating %}
                                    {% with count=count|add:1 %}{% endwith %}
                                {% endif %}
                            {% endfor %}
                            <div class="text-center">
                                <div class="fw-bold">{{ rating }}</div>
                                <div class="progress" style="height: 60px; writing-mode: vertical-lr;">
                                    <div class="progress-bar bg-success" style="height: {% if total > 0 %}{% widthratio count total 100 %}{% else %}0{% endif %}%"></div>
                                </div>
                                <small>{{ count }}</small>
                            </div>
                        {% endwith %}
                    </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-muted">No hay respuestas para esta pregunta</p>
            {% endif %}
        {% endwith %}
    {% endif %}
</div>
{% endfor %}